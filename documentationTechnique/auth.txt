backend/app/core/security.py

Variables :

SECRET_KEY, ALGORITHM, ACCESS_TOKEN_EXPIRE_MINUTES â†’ depuis .env

oauth2_scheme â†’ FastAPI OAuth2PasswordBearer pour sÃ©curiser les endpoints

Fonctions :

create_access_token(data: dict, expires_delta: Optional[timedelta]) -> str
â†’ GÃ©nÃ¨re un JWT pour lâ€™utilisateur.

decode_access_token(token: str) -> dict
â†’ DÃ©code le JWT et retourne le payload.

get_current_user(token: str = Depends(oauth2_scheme), db: Session = Depends(get_db)) -> UserRead
â†’ VÃ©rifie le token et retourne lâ€™utilisateur connectÃ©.

Objet de sÃ©curitÃ© :

pwd_context â†’ PassLib context pour hasher et vÃ©rifier les mots de passe.

backend/app/crud/user.py

Fonctions :

get_user_by_email(db: Session, email: str) -> User | None
â†’ RÃ©cupÃ¨re un utilisateur par email.

create_user(db: Session, user: UserCreate, hashed_password: str, is_admin=False) -> User
â†’ CrÃ©e un utilisateur avec le mot de passe hashÃ© et option admin.

backend/app/schemas/user.py

Pydantic Models :

UserBase â†’ email seulement

UserCreate â†’ email + password

UserRead â†’ id, email, is_active, is_admin, created_at, updated_at (avec model_config["from_attributes"] = True pour ORM)

backend/app/api/v1/endpoints/auth.py

Endpoints :

POST /signup â†’ crÃ©er un utilisateur, hash du mot de passe inclus

POST /login â†’ vÃ©rifier identifiants, retourne JWT

GET /me â†’ retourne lâ€™utilisateur connectÃ© (Depends(get_current_user))

ğŸ”¹ Flux gÃ©nÃ©ral de lâ€™auth

Signup â†’ hash password â†’ create_user

Login â†’ vÃ©rifier password avec pwd_context.verify â†’ crÃ©er JWT avec create_access_token

Protected routes â†’ Depends(get_current_user) â†’ decode JWT â†’ retourne UserRead

-------------------------------------------------------------------------------------------------------------------

AmÃ©lioration pour la suite : 


1ï¸âƒ£ Gestion des secrets et sÃ©curitÃ©

âœ… Les secrets (SECRET_KEY, ALGORITHM, ACCESS_TOKEN_EXPIRE_MINUTES) sont dans .env â†’ bien.

âš ï¸ AmÃ©lioration possible : utiliser un gestionnaire de secrets (Vault, AWS Secrets Manager, etc.) pour les environnements prod.

âš ï¸ ClÃ© secrÃ¨te : sâ€™assurer quâ€™elle est longue et alÃ©atoire, pas juste une chaÃ®ne fixe.

2ï¸âƒ£ Password hashing

âœ… bcrypt via pwd_context â†’ correct.

âš ï¸ AmÃ©lioration possible : augmenter le nombre de rounds si nÃ©cessaire pour renforcer la sÃ©curitÃ©, surtout si câ€™est prod.

3ï¸âƒ£ JWT / Token Management

âœ… python-jose avec expiration â†’ correct.

âš ï¸ AmÃ©lioration possible : ajouter refresh tokens pour ne pas forcer un login tous les 30 min, surtout si tu veux un site plus sÃ©rieux.

âš ï¸ Pour les endpoints sensibles, envisager roles/permissions plutÃ´t quâ€™un simple is_admin.

4ï¸âƒ£ Structure du code

âœ… SÃ©paration crud, schemas, models, api â†’ bonne pratique.

âš ï¸ AmÃ©lioration possible : crÃ©er un module services pour encapsuler certaines logiques mÃ©tiers (ex: crÃ©ation dâ€™utilisateur + envoi dâ€™email de bienvenue).

5ï¸âƒ£ Gestion des erreurs et retours

âœ… HTTPException avec status code â†’ correct.

âš ï¸ AmÃ©lioration possible : crÃ©er des classes dâ€™erreurs centralisÃ©es ou des rÃ©ponses standardisÃ©es (ex: {"error": "...", "code": ...}) pour uniformiser lâ€™API.

6ï¸âƒ£ Tests

âš ï¸ Non fait pour lâ€™instant : ajouter des tests unitaires et tests dâ€™intÃ©gration pourâ€¯:

signup/login

accÃ¨s aux endpoints protÃ©gÃ©s

crÃ©ation dâ€™utilisateur admin/non-admin

7ï¸âƒ£ Logging / Monitoring

âš ï¸ Pour la prod : ajouter un systÃ¨me de logs centralisÃ© et de monitoring pour dÃ©tecter les tentatives de connexion suspectes.